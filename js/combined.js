let dataSiswa=ambilData("siswa")||[],dataAbsen=ambilData("absen")||[],indexDataUpdate=-1;const Sheet1="Data Siswa",Sheet2="Data Absen";function ambilData(e){const t=localStorage.getItem(e);return typeof t=="undefined"||t===null?null:(console.log(t),JSON.parse(t).data)}function simpanData(e,t){const n=JSON.stringify({data:t});console.log(n),localStorage.setItem(e,n)}const elBody=document.getElementById("body"),elFormSiswa=document.getElementById("form-siswa"),elFormAbsen=document.getElementById("form-absen"),elNamaSiswa=document.getElementById("nama-siswa"),elNomorAbsenSiswa=document.getElementById("nomor-absen-siswa"),elNomorAbsen=document.getElementById("nomor-absen"),elKelas=document.getElementById("kelas"),elButtonSiswa=document.getElementById("tombol-siswa"),elButtonAbsen=document.getElementById("tombol-absen"),elUploadFile=document.getElementById("upload"),elModalTitle=document.getElementById("modal-title"),elModalBody=document.getElementById("modal-body"),elNavMenu=document.querySelectorAll(".menu-halaman"),elPage={"home-page":document.getElementById("home-page"),"siswa-page":document.getElementById("siswa-page"),"absen-page":document.getElementById("absen-page")};elButtonAbsen.addEventListener("click",tambahDataAbsen);const elemenTabel=document.getElementById("data-absen");function tampilkanDataAbsen(){elemenTabel.innerHTML="";const e=dataAbsen.length;for(let n=0;n<e;n++){const t=dataAbsen[n],s=dataSiswa.find(e=>e.nomor===t.nomor);if(typeof s=="undefined")continue;const o=document.createElement("tr");o.innerHTML=`<td>${t.nomor}</td><td>${s.nama}</td><td>${t.hari}</td><td>${t.jam}</td>`,elemenTabel.appendChild(o)}}function tambahDataAbsen(){console.log("tombol tambah data absen di-klik");let t=elNomorAbsen.value;if(t===""){alert("Mohon lengkapi isian!");return}const n=dataSiswa.find(e=>e.nomor===t);if(typeof n=="undefined"){alert("Data Siswa tidak ditemukan!");return}const e=new Date,i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0"),s=`${i}-${a}-${r}`,u=`${c}:${l}:${d}`,o=dataAbsen.find(e=>e.hari===s&&e.nomor===t);if(console.log(JSON.stringify({cariAbsen:o})),typeof o!="undefined"){alert(`${n.nama} sudah absen hari ini`);return}dataAbsen.push({nomor:t,hari:s,jam:u}),simpanData("absen",dataAbsen),console.log(JSON.stringify({dataAbsen})),tampilkanDataAbsen(),elFormAbsen.reset()}tampilkanDataAbsen();function downloadExcel(){const t=XLSX.utils.book_new(),s=XLSX.utils.json_to_sheet(dataSiswa),n=[];for(let t=0;t<dataAbsen.length;t++){const e=dataAbsen[t],s=dataSiswa.find(t=>t.nomor===e.nomor);if(typeof s=="undefined")continue;n.push({nomor:e.nomor,nama:s.nama,hari:e.hari,jam:e.jam})}const o=XLSX.utils.json_to_sheet(n);XLSX.utils.book_append_sheet(t,s,Sheet1),XLSX.utils.book_append_sheet(t,o,Sheet2);const i=XLSX.write(t,{bookType:"xlsx",type:"array"}),a=new Blob([new Uint8Array(i)],{type:"application/octet-stream"}),e=document.createElement("a");e.href=URL.createObjectURL(a),e.download="absen.xlsx",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function xlsxToStore(){const t=document.getElementById("upload"),n=t.files[0],e=new FileReader;e.onload=function(e){const n=e.target.result,t=XLSX.read(n,{type:"binary"}),s=t.Sheets[Sheet1],o=t.Sheets[Sheet2];dataSiswa=XLSX.utils.sheet_to_json(s),dataAbsen=XLSX.utils.sheet_to_json(o),simpanData("siswa",dataSiswa),simpanData("absen",dataAbsen),tampilkanDataSiswa(),tampilkanDataAbsen()},e.readAsBinaryString(n)}elNavMenu.forEach(e=>{e.addEventListener("click",bukaHalaman)});function bukaHalaman(e){e.preventDefault(),elNavMenu.forEach(e=>{e.classList.remove("active")}),this.classList.add("active");const t=this.getAttribute("menu");for(const e in elPage)if(Object.hasOwnProperty.call(elPage,e)){const t=elPage[e];t.classList.remove("d-none")}for(const e in elPage)if(Object.hasOwnProperty.call(elPage,e)){const n=elPage[e];e!==t&&n.classList.add("d-none")}elBody.classList.remove("align-items-center","d-flex"),t==="home-page"&&elBody.classList.add("align-items-center","d-flex")}function buatKodeQR(e){elModalTitle.innerText="Kode QR",elModalBody.innerHTML="";const t=document.createElement("div");t.setAttribute("class","m-auto"),t.setAttribute("style","width: 300px");const n=new QRCode(t,{text:e,width:300,height:300,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});elModalBody.innerHTML="",elModalBody.appendChild(t)}elButtonSiswa.addEventListener("click",tambahSiswa);const elTabelSiswa=document.getElementById("data-siswa");function tampilkanDataSiswa(){elTabelSiswa.innerHTML="";const e=dataSiswa.length;for(let t=0;t<e;t++){const n=dataSiswa[t],s=document.createElement("tr");s.innerHTML=`
    <td class="text-center">
      ${n.nomor} 
      <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#kodeQRModal" onclick="buatKodeQR('${n.nomor}-${n.nama}')">
        <i class="bi bi-qr-code"></i>
      </button>
    </td>
    <td>${n.nama}</td><td>${n.kelas}</td>
    <td class="text-center">
      <button type="button" onclick="tampilkanUpdateDataSiswa(${t})" class="btn btn-link">
      <i class="bi bi-pencil-square"></i>
      </button>
      <button type="button" onclick="hapusDataSiswa(${t})" class="btn btn-link">
      <i class="bi bi-trash3"></i>
      </button>
    </td>`,elTabelSiswa.appendChild(s)}}function tampilkanUpdateDataSiswa(e){indexDataUpdate=e;const t=dataSiswa[e];elNamaSiswa.value=t.nama,elNomorAbsenSiswa.value=t.nomor,elKelas.value=t.kelas,elButton.innerText="Update Data"}function hapusDataSiswa(e){dataSiswa.splice(e,1),simpanData("siswa",dataSiswa),tampilkanDataSiswa()}function tambahSiswa(){console.log("tombol tambah data di-klik");let t=elNamaSiswa.value,e=elNomorAbsenSiswa.value,n=elKelas.value;if(t===""||e===""||n===""){alert("Mohon lengkapi isian!");return}const s=dataSiswa.find(t=>t.nomor===e);if(typeof s!="undefined"){alert("Nomor Absen Sudah Digunakan");return}indexDataUpdate>0?(elButton.innerText="Tambah Data",dataSiswa.splice(indexDataUpdate,1,{nomor:e,nama:t,kelas:n}),indexDataUpdate=-1):dataSiswa.push({nomor:e,nama:t,kelas:n}),simpanData("siswa",dataSiswa),console.log(JSON.stringify({dataSiswa})),tampilkanDataSiswa(),elFormSiswa.reset()}tampilkanDataSiswa()